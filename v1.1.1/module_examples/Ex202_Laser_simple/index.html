<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Simple laser structure with 5 layers. · ChargeTransport.jl</title><meta name="title" content="Simple laser structure with 5 layers. · ChargeTransport.jl"/><meta property="og:title" content="Simple laser structure with 5 layers. · ChargeTransport.jl"/><meta property="twitter:title" content="Simple laser structure with 5 layers. · ChargeTransport.jl"/><meta name="description" content="Documentation for ChargeTransport.jl."/><meta property="og:description" content="Documentation for ChargeTransport.jl."/><meta property="twitter:description" content="Documentation for ChargeTransport.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../general/">ChargeTransport.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../general/">Home</a></li><li><a class="tocitem" href="../../changes/">Changelog</a></li><li><a class="tocitem" href="../../backgroundinfo/">Mathematical drift-diffusion models</a></li><li><span class="tocitem">How to get started</span><ul><li><a class="tocitem" href="../../GaAs/">van Roosbroeck system</a></li><li><a class="tocitem" href="../../PSC/">Perovskite solar cell</a></li></ul></li><li><a class="tocitem" href="../../allindex/">Types, Constructors and Methods</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../Ex101_PIN/">GaAs diode (1D).</a></li><li><a class="tocitem" href="../Ex102_PIN_nodal_doping/">GaAs diode with spatially varying doping (1D).</a></li><li><a class="tocitem" href="../Ex103_PSC_IVMeasurement/">PSC device with ions and different I-V scan protocols (1D).</a></li><li><a class="tocitem" href="../Ex104_PSC_Photogeneration/">PSC device with photogeneration rate (1D).</a></li><li><a class="tocitem" href="../Ex105_PSC_gradedFlux/">Three-layer PSC device with graded interfaces &amp; Ohmic contacts (1D).</a></li><li><a class="tocitem" href="../Ex106_PSC_SurfaceRecombination/">PSC device with surface recombination (1D).</a></li><li><a class="tocitem" href="../Ex107_MoS2_withIons_BarrierLowering/">MoS2 with moving defects and Schottky Barrier Lowering.</a></li><li><a class="tocitem" href="../Ex108_CIGS/">CIGS: stationary with Schottky contacts.</a></li><li><a class="tocitem" href="../Ex109_PSC_NonDimensional/">Nondimensionalized perovskite solar cell.</a></li><li><a class="tocitem" href="../Ex201_PSC_tensorGrid/">PSC device on 2D domain (Tensor grid).</a></li><li class="is-active"><a class="tocitem" href>Simple laser structure with 5 layers.</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Simple laser structure with 5 layers.</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Simple laser structure with 5 layers.</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/WIAS-PDELib/ChargeTransport.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Simple-laser-structure-with-5-layers."><a class="docs-heading-anchor" href="#Simple-laser-structure-with-5-layers.">Simple laser structure with 5 layers.</a><a id="Simple-laser-structure-with-5-layers.-1"></a><a class="docs-heading-anchor-permalink" href="#Simple-laser-structure-with-5-layers." title="Permalink"></a></h1><p>(<a href="../Ex202_Laser_simple.jl">source code</a>)</p><p>Simulating a simple laser structure with 5 layers. The layers are defined by their material properties and thicknesses. The simulation will solve the charge transport equations across the layers, taking into account the stimulated recombination in the active region of the laser structure.</p><pre><code class="language-julia hljs">module Ex202_Laser_simple

using ChargeTransport
using ExtendableGrids
using GridVisualize
using PyPlot

###########################################################################
numberOfColoumns = Dict(
    &quot;ref1&quot; =&gt; [2, 4],
    &quot;ref2&quot; =&gt; [4, 8],
    &quot;ref3&quot; =&gt; [8, 16],
    &quot;ref4&quot; =&gt; [16, 32],
    &quot;ref5&quot; =&gt; [32, 64]
)

numberOfRows = Dict(
    &quot;ref1&quot; =&gt; [4, 8, 2, 8, 4],
    &quot;ref2&quot; =&gt; [8, 16, 4, 16, 8],
    &quot;ref3&quot; =&gt; [16, 32, 8, 32, 16],
    &quot;ref4&quot; =&gt; [32, 64, 16, 64, 32],
    &quot;ref5&quot; =&gt; [64, 128, 32, 128, 64]
)
###################################################################

&quot;&quot;&quot; Initializing X and Y coords for the tesca grid&quot;&quot;&quot;
function tesca_grid(; refinement = 1, showplot = false, airbox = false)

    @local_unitfactors μm

    ncol = numberOfColoumns[&quot;ref$(refinement)&quot;]
    nrow = numberOfRows[&quot;ref$(refinement)&quot;]

    widths_columns = [1.0  10.0] * μm
    heights_rows = [1.0  0.5  0.05  0.5  1.0] * μm

    coord_x1 = collect(range(0.0, widths_columns[1], length = ncol[1] + 1))
    coord_x2 = collect(range(widths_columns[1], sum(widths_columns[1:2]), length = ncol[2] + 1))
    X = glue(coord_x1, coord_x2)
    X = glue(reverse(-X), X)

    coord_y1 = collect(range(0.0, heights_rows[1], length = nrow[1] + 1))
    coord_y2 = collect(range(heights_rows[1], sum(heights_rows[1:2]), length = nrow[2] + 1))
    coord_y3 = collect(range(sum(heights_rows[1:2]), sum(heights_rows[1:3]), length = nrow[3] + 1))
    coord_y4 = collect(range(sum(heights_rows[1:3]), sum(heights_rows[1:4]), length = nrow[4] + 1))
    coord_y5 = collect(range(sum(heights_rows[1:4]), sum(heights_rows[1:5]), length = nrow[5] + 1))
    Y = glue(glue(glue(glue(coord_y1, coord_y2), coord_y3), coord_y4), coord_y5)

    grid = simplexgrid(X, Y)

    cellmask!(grid, [X[1], 0.0], [sum(widths_columns), heights_rows[1]], 1)
    cellmask!(grid, [X[1], heights_rows[1]], [sum(widths_columns), sum(heights_rows[1:2])], 2)
    cellmask!(grid, [X[1], sum(heights_rows[1:2])], [sum(widths_columns), sum(heights_rows[1:3])], 3)
    cellmask!(grid, [X[1], sum(heights_rows[1:3])], [sum(widths_columns), sum(heights_rows[1:4])], 4)
    cellmask!(grid, [X[1], sum(heights_rows[1:4])], [sum(widths_columns), sum(heights_rows[1:5])], 5)</code></pre><p>AIR</p><pre><code class="language-julia hljs">    cellmask!(grid, [widths_columns[1], sum(heights_rows[1:4])], [sum(widths_columns), sum(heights_rows[1:5])], 6)
    cellmask!(grid, [X[1], sum(heights_rows[1:4])], [-widths_columns[1], sum(heights_rows[1:5])], 6)

    bregionDonor1 = 1      # bottom boundary
    bregionAcceptor2 = 2   # top boundary
    bregionNoFlux = 3
    bregionAirBox = 4
    bfacemask!(grid, [-widths_columns[1], sum(heights_rows)], [widths_columns[1], sum(heights_rows)], bregionAcceptor2)
    bfacemask!(grid, [X[1], 0.0], [X[end], 0.0], bregionDonor1)

    bfacemask!(grid, [X[1], 0.0], [X[1], sum(heights_rows[1:4])], bregionNoFlux)
    bfacemask!(grid, [X[1], sum(heights_rows[1:4])], [-widths_columns[1], sum(heights_rows[1:4])], bregionNoFlux)
    bfacemask!(grid, [-widths_columns[1], sum(heights_rows[1:4])], [-widths_columns[1], sum(heights_rows)], bregionNoFlux)

    bfacemask!(grid, [X[end], 0.0], [X[end], sum(heights_rows[1:4])], bregionNoFlux)
    bfacemask!(grid, [widths_columns[1], sum(heights_rows[1:4])], [X[end], sum(heights_rows[1:4])], bregionNoFlux)
    bfacemask!(grid, [widths_columns[1], sum(heights_rows[1:4])], [widths_columns[1], sum(heights_rows)], bregionNoFlux)

    bfacemask!(grid, [X[1], sum(heights_rows[1:4])], [X[1], Y[end]], bregionAirBox)
    bfacemask!(grid, [X[1], Y[end]], [-widths_columns[1], Y[end]], bregionAirBox)
    bfacemask!(grid, [widths_columns[1], Y[end]], [X[end], Y[end]], bregionAirBox)
    bfacemask!(grid, [X[end], sum(heights_rows[1:4])], [X[end], Y[end]], bregionAirBox)

    if airbox == false
        grid = subgrid(grid, [1, 2, 3, 4, 5])
    end

    if showplot == true
        GridVisualize.gridplot(
            grid, Plotter = PyPlot, linewidth = 1, fontsize = 35, size = (1200, 900),
            legend = :best, show = true, aspect = 4, colorbar = false, title = &quot;Device Geometry, values in [m]&quot;, xlabel = &quot;x-coordinates&quot;, ylabel = &quot;y-coordinates&quot;
        )
    end

    return grid
end

function main(;
        refinement = 1, plotting = false, verbose = false, test = false, unknown_storage = :sparse,
        numberOfEigenvalues = 1,
        parameter_set = Params_Laser_simple # choose the parameter set
    )</code></pre><p>parameter</p><pre><code class="language-julia hljs">    p = parameter_set()

    ################################################################################
    if test == false
        println(&quot;Set up grid.&quot;)
    end
    ################################################################################

    grid = tesca_grid(refinement = refinement, showplot = plotting, airbox = false)

    if test == false
        println(&quot;*** done\n&quot;)
    end

    ################################################################################
    if test == false
        println(&quot;Define System and fill in information about model&quot;)
    end
    ################################################################################

    # Initialize Data instance and fill in data
    data = Data(grid, p.numberOfCarriers, numberOfEigenvalues = numberOfEigenvalues)

    # Possible choices: Stationary, Transient
    data.modelType = Stationary

    # Possible choices: Boltzmann, FermiDiracOneHalfBednarczyk, FermiDiracOneHalfTeSCA,
    # FermiDiracMinusOne, Blakemore.
    # Can be a vector with different statistics (for n and p).
    data.F .= FermiDiracOneHalfTeSCA

    data.bulkRecombination = set_bulk_recombination(;
        iphin = p.iphin, iphip = p.iphip,
        bulk_recomb_Auger = true,
        bulk_recomb_radiative = true,
        bulk_recomb_SRH = true
    )

    data.boundaryType[p.bregionAcceptor2] = OhmicContact  # top boundary Dirichlet condition
    data.boundaryType[p.bregionDonor1] = OhmicContact     # bottom boundary Dirichlet condition</code></pre><pre><code class="nohighlight hljs">                                                # rest is set to Neumann by default</code></pre><pre><code class="language-julia hljs">    data.fluxApproximation .= ExcessChemicalPotential
    #data.fluxApproximation .= ScharfetterGummel          # if F=Boltzmann

    if test == false
        println(&quot;*** done\n&quot;)
    end

    ################################################################################
    if test == false
        println(&quot;Define Params and fill in physical parameters&quot;)
    end
    ################################################################################

    &quot;&quot;&quot; Data from Params_Laser_simple.jl: temperature T, band edge energies EC, EV, effective density of states NC, NV
        mobilities μn, μp, dielectricConstant εs, radiative recombination r0, life times τn, τp,
        Auger recombination coefficients Auger_Cn, Auger_Cp
        doping doping (or vcat(Nd,Na) = doping).
    &quot;&quot;&quot;
    paramsoptical = ParamsOptical(grid, p.numberOfCarriers, numberOfEigenvalues)
    paramsoptical.laserWavelength = p.λ

    paramsoptical.absorption_0[:] = p.α0
    paramsoptical.gain_0[:] = p.gain0
    paramsoptical.refractiveIndex_0[:] = p.nTilde
    paramsoptical.refractiveIndex_d[:] = p.nTilde_d
    paramsoptical.refractiveIndex_γ[:] = p.γn
    paramsoptical.absorptionFreeCarriers[p.iphin, :] = p.fcnalf
    paramsoptical.absorptionFreeCarriers[p.iphip, :] = p.fcpalf

    paramsoptical.eigenvalues .= 1 + 1 * im   # dummy value for initializing

    data.params = Params(p)
    data.paramsoptical = paramsoptical

    ctsys = System(grid, data, unknown_storage = unknown_storage)

    if test == false
        show_params(ctsys)
        println(&quot;*** done\n&quot;)
    end

    ################################################################################
    if test == false
        println(&quot;Define control parameters for Solver&quot;)
    end
    ################################################################################

    control = SolverControl()
    control.verbose = verbose
    control.maxiters = 300
    control.abstol = 1.0e-7
    control.reltol = 1.0e-7
    control.tol_round = 1.0e-7
    control.max_round = 3
    control.damp_initial = 0.8   # &lt; 1

    if test == false
        println(&quot;*** done\n&quot;)
    end

    ################################################################################
    if test == false
        println(&quot;Compute solution in thermodynamic equilibrium for Boltzmann&quot;)
    end
    ################################################################################

    # calculate equilibrium solution and set as initial guess
    psi0Vector = electroNeutralSolution(ctsys)

    inival = unknowns(ctsys)
    inival[1, :] = inival[2, :] .= 0.0
    inival[3, :] = psi0Vector

    solution = equilibrium_solve!(ctsys, inival = inival, control = control, nonlinear_steps = 20.0)
    inival = solution

    if test == false
        println(&quot;*** done\n&quot;)
    end

    ################################################################################
    if test == false
        println(&quot;Bias loop&quot;)
    end
    ################################################################################

    maxBias = p.U[end]  # = 1.81 = topVoltageAcceptor2 # bias goes until the given voltage at acceptor boundary
    biasValues = range(0, stop = maxBias, length = 40)

    for Δu in biasValues

        if test == false
            println(&quot;bias value: Δu = &quot;, Δu, &quot; V&quot;)
        end

        # set non equilibrium boundary conditions
        set_contact!(ctsys, p.bregionAcceptor2, Δu = Δu)

        solution = solve(ctsys; inival = inival, control = control)
        inival .= solution

    end # bias loop

    if test == false
        println(&quot;*** done\n&quot;)
    end

    #########################################################

    ctsys.data.paramsoptical.oldSolution = solution
    currentSolution = solution
    inival = solution

    ############################
    ctsys.data.paramsoptical.eigenvalues = p.λ1
    ctsys.data.paramsoptical.eigenvectors = reshape(p.v1, length(p.v1), 1)  # reshaping because in system it must be a 2D array
    ctsys.data.paramsoptical.power = p.P[2]

    solution = solve(ctsys; inival = inival, control = control)
    ctsys.data.paramsoptical.oldSolution = solution
    currentSolution = solution
    inival = solution

    if plotting
        vis = GridVisualizer(; Plotter = PyPlot, fignumber = 2, resolution = (1200, 900))

        scalarplot!(
            vis, grid, solution[1, :], Plotter = PyPlot, legend = :best, clear = false, title = &quot;Applied voltage Δu = $maxBias V&quot;,
            xlabel = &quot;cross section space along \$x=0\$ [m]&quot;, ylabel = &quot;potentials [V]&quot;, fontsize = 55, linewidth = 5,
            slice = :x =&gt; 0, label = &quot;\$ \\varphi_n \$&quot;, color = &quot;blue&quot;
        )

        scalarplot!(
            vis, grid, solution[2, :], Plotter = PyPlot, linewidth = 5,
            slice = :x =&gt; 0, label = &quot;\$ \\varphi_p \$&quot;, clear = false, color = &quot;mediumvioletred&quot;
        )

        scalarplot!(
            vis, grid, solution[3, :], Plotter = PyPlot, linewidth = 5,
            slice = :x =&gt; 0, label = &quot;\$ \\psi \$&quot;, clear = false, color = &quot;darkorange&quot;
        )
    end


    testval = sum(solution) / length(solution)
    return testval

end # main

function test()
    testval = 0.5122451923673309
    return main(test = true) ≈ testval
end

if test == false
    println(&quot;This message should show when this module is successfully recompiled.&quot;)
end

end # module</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Ex201_PSC_tensorGrid/">« PSC device on 2D domain (Tensor grid).</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 12 August 2025 10:00">Tuesday 12 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
